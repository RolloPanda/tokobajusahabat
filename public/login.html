<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Login - Toko Baju Sahabat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #f8f9fa;
        margin: 0;
        padding: 0;
      }
      .navbar-brand {
        color: #fff !important;
        letter-spacing: .5px;
        font-weight: 700;
      }
      .navbar {
        background: #8B004B !important;
        box-shadow: 0 2px 10px 0 rgba(139,0,75,.07);
      }
      .btn-outline-light {
        border-radius: 7px;
        border: 1.4px solid #fff;
        color: #fff;
        font-weight: 600;
      }
      .btn-outline-light:hover {
        background: #fff;
        color: #8B004B;
        border-color: #fff;
      }
      /* Login form styling */
      .login-container {
        min-height: 83vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px;
      }
      .login-card {
        background: #fff;
        padding: 32px 28px 26px 28px;
        border-radius: 1.2em;
        box-shadow: 0 8px 34px #8B004B16;
        width: 330px;
        max-width: 97vw;
      }
      .login-card h2 {
        color: #8B004B;
        font-weight: 700;
        text-align: center;
        margin-bottom: 1.4rem;
      }
      .login-card .form-label {
        font-weight: 600;
        color: #8B004B;
      }
      .login-card .btn-primary {
        background-color: #8B004B;
        border: none;
        font-weight: 600;
        font-size: 1.09rem;
        margin-top: 0.5rem;
        border-radius: 8px;
      }
      .login-card .btn-primary:hover {
        background-color: #6a0037;
      }
      .login-card .text-end a {
        color: #8B004B;
        text-decoration: none;
        font-size: 0.94em;
      }
      .login-card .text-end a:hover {
        text-decoration: underline;
        color: #a02c6c;
      }

      /* Toast Styles */
      #toast-container {
        position: fixed;
        top: 52%;
        left: 50%;
        transform: translate(-50%,-50%);
        z-index: 1200;
        max-width: 95vw;
        display: flex;
        flex-direction: column;
        align-items: center;
        pointer-events: none;
      }
      .toko-toast {
        min-width: 220px;
        max-width: 330px;
        color: #fff;
        background: linear-gradient(90deg,#8B004B,#ad1457);
        border-radius: 13px;
        padding: 1rem 1.35rem;
        margin-bottom: 14px;
        box-shadow: 0 4px 22px #8B004B11;
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.05rem;
        opacity: 0;
        transform: translateY(33px) scale(0.97);
        animation: slideInCenter .45s forwards;
        gap: 0.7rem;
        pointer-events: auto;
      }
      .toko-toast.toko-toast-error {
        background: linear-gradient(90deg,#C62828,#FF5252);
      }
      .toko-toast.toko-toast-info {
        background: linear-gradient(90deg,#1976D2,#64B5F6);
      }
      @keyframes slideInCenter {
        to { opacity: 1; transform: none;}
      }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="index.html">Toko Baju Sahabat</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" 
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="border:none;">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4"></ul>
                <div class="d-flex">
                    <a href="daftarakun.html" class="btn btn-outline-light">Buat Akun</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Form -->
    <div class="login-container">
      <form class="login-card" autocomplete="off">
          <h2>Login</h2>
          <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" placeholder="Masukkan email" required />
          </div>
          <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password" placeholder="Masukkan password" required />
          </div>
          <div class="mb-3 text-end">
              <a href="lupapassword.html">Lupa Password?</a>
          </div>
          <button type="submit" class="btn btn-primary w-100">Masuk</button>
      </form>
    </div>

    <!-- Toast container -->
    <div id="toast-container"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      function showToast(msg, type = "success", duration = 2200) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toko-toast toko-toast-' + type;
        let icon = `<i class="bi bi-check-circle-fill"></i>`;
        if (type === "error") icon = `<i class="bi bi-x-circle-fill"></i>`;
        if (type === "info") icon = `<i class="bi bi-info-circle-fill"></i>`;
        toast.innerHTML = icon + `<span style="flex:1;">${msg}</span>`;
        container.appendChild(toast);
        setTimeout(() => {
          toast.style.opacity = 0;
          toast.style.transform = "translateY(30px) scale(0.96)";
          setTimeout(() => toast.remove(), 420);
        }, duration);
      }

      document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('name')) {
          window.location.href = 'index.html';
          return;
        }
        const form = document.querySelector('form');
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.querySelector('#email').value.trim();
          const password = document.querySelector('#password').value.trim();
          if (!email || !password) {
            showToast('Email dan password harus diisi.', "error");
            return;
          }
          try {
            const response = await fetch('/api/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, password })
            });
            const data = await response.json();
            if (!response.ok) {
              showToast(data.message || 'Login gagal', "error");
            } else {
              localStorage.setItem('name', data.user.name || '');
              localStorage.setItem('email', data.user.email || '');
              if (data.token) localStorage.setItem('token', data.token);
              showToast('Login berhasil!');
              setTimeout(() => window.location.href = 'index.html', 1100);
            }
          } catch (err) {
            showToast('Terjadi kesalahan. Silakan coba lagi.', "error");
          }
        });
      });
    </script>
</body>
</html>
